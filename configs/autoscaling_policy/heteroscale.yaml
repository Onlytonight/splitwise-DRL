# HeteroScale (TPS-based + Latency-based) 自动扩缩容策略
# 生产环境推荐的策略，包含两个机制：
# 1. 比例控制（主推力）：基于 Decode TPS 的日常扩缩容
# 2. 延迟触发（安全网）：基于 TBT 的紧急扩容

_target_: autoscaling_policies.HeteroScalePolicy

policy_name: HeteroScale

# === 比例控制参数 ===
# 单实例目标 Decode TPS（根据实际模型和硬件调整）
target_decode_tps_per_instance: 100.0

# P/D 比例 (Prefill / Decode)
# 例如 0.33 表示 1 个 Prefill 对应 3 个 Decode (1:3)
pd_ratio: 1.28

# 扩容阈值（10% = 0.1）
scale_out_threshold: 0.2

# 缩容阈值（10% = 0.1）
scale_in_threshold: 0.2

# 实例数量限制
min_instances: 1
max_instances: 100

# === 延迟触发参数（安全网）===
# 是否启用延迟触发
enable_latency_trigger: true

# TBT SLO（秒）- Time Between Tokens 的服务等级目标
tbt_slo: 0.038

# 延迟恐慌阈值（1.2 表示 TBT > 1.2 × SLO 时触发）
latency_panic_threshold: 1.2

# 恐慌时扩容倍数（1.2 表示扩容 20%）
latency_panic_scale_factor: 1.2

# === 冷却时间（秒）===
scale_out_cooldown: 1.0  # 扩容冷却 3 分钟
scale_in_cooldown: 1.0   # 缩容冷却 10 分钟

# 调试模式
debug: false

